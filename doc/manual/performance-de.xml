<chapter id="school:performance:general">
  <title>Hinweise für große &ucsUAS;-Umgebungen</title>
  <para>
	Die Standardkonfiguration von &ucsUCS; und &ucsUAS; ist für Umgebungen mit bis zu 5.000
	Benutzern optimiert worden. In größeren Umgebungen kann es notwendig werden, Anpassungen an der
	Standardkonfiguration vorzunehmen. Die meisten Schritte werden bereits im <emphasis>UCS performance
	guide</emphasis> <biblioref linkend="ucs-performance-guide"/> beschrieben.
  </para>
  <para>
	Darüber hinaus sollten einige Punkte bereits bei der Planung und dem Aufbau einer &ucsUAS;-Umgebung beachtet werden:
	<itemizedlist>
	  <listitem>
		<simpara>
		  Durch die Verwendung einer Multi-Server-Umgebung und einer geeigneten Unterteilung der
		  Benutzerkonten auf mehrere Schul-OUs kann die Last der einzelnen Schulserver bei einer großen
		  Gesamtanzahl an Benutzern erheblich reduziert werden. Zusätzlich wird durch die Unterteilung für die
		  Nutzer das Bedienen der &ucsUAS;-Systeme erleichtert, da zum Beispiel die Menge der angezeigten
		  Benutzer, Klassen, Räume usw. auf die jeweilige Schul-OU eingeschränkt wird.
		</simpara>
	  </listitem>
	  <listitem>
		<simpara>
		  Gruppen mit einer großen Anzahl an Mitgliedern können negative Auswirkungen auf die
		  Geschwindigkeit der &ucsUAS;-Systeme haben.  Es sollte daher beim Anlegen von Benutzern vermieden
		  werden, dass alle Benutzer Mitglied einer bestimmten Gruppe (z.B. "Domain Users") werden.  Die
		  &ucsUAS;-Importskripte beachten dies bereits und legen pro Schul-OU eine eigene Gruppe
		  <emphasis>Domain Users OUNAME</emphasis> an, die als primäre Gruppe für die Benutzerkonten verwendet
		  wird.
		</simpara>
		<simpara>
		  Falls für die Rechteverwaltung eine Zusammenfassung der Benutzer notwendig ist, können
		  mehrere dieser Gruppen über die <emphasis>Gruppen in Gruppen</emphasis>-Funktionalität
		  zusammengeführt werden.  Die einzelnen <emphasis>Domain User OUNAME</emphasis>-Gruppen können dann
		  bei Bedarf z.B. als Mitglied in der Gruppe <emphasis>Domain Users</emphasis> eingetragen werden.
		</simpara>
	  </listitem>
	</itemizedlist>
  </para>

  <section id="school:performance:scaling">
	<title>Skalierung von &ucsUAS; Samba 4 Umgebungen</title>

    <section id="school:performance:additionalMemberserver">
  	<title>Installation zusätzlicher Memberserver</title>
  	<para>
  	  In &ucsUAS; Umgebungen in denen Samba 4 Active Directory kompatible Dienste bereitstellt,
	  kann ein zusätzlicher UCS Memberserver an einem Schulstandort installiert werden.
  	</para>
  	<para>
  	  Um einen solchen zusätzlichen Memberserver an einem Schulstandort zu installieren und zu joinen, müssen
	  vorbereitende Schritte durchgeführt werden:
  	  <itemizedlist>
  		<listitem>
  		  <simpara>
			Für den neuen Memberserver muss im <emphasis>computers</emphasis>-Container der gewünschten Schul-OU ein
			Rechnerobjekt angelegt werden. Der Name des Rechnerobjekts muss mit dem Hostnamen übereinstimmen, mit dem
			der neue Memberserver installiert wurde.
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
			Der Memberserver muss in die Gruppen <emphasis>Member-Edukativnetz</emphasis> und
			<emphasis>OU&lt;OUNAME&gt;-Member-Edukativnetz</emphasis> eingetragen werden.
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
			Im &ucsUDM; sollte eine &ucsUCR; Richtlinie angelegt werden, die die UCR-Variable <emphasis>ldap/server/name</emphasis>
			auf den Namen des gewünschten Schulservers setzt. Diese &ucsUCR; Richtlinie sollte dann mit der gewünschten Schul-OU
			oder mit dem Container verknüpft werden, in dem das Rechnerobjekt des Memberservers positioniert ist.
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
			Auf dem Memberserver selbst muss vor dem Joinen die UCR-Variable <emphasis>nameserver1</emphasis>
			auf die IP-Adresse des Schulservers gesetzt werden. Die UCR-Variablen <emphasis>nameserver2</emphasis>
			und <emphasis>nameserver3</emphasis> sollten nicht gesetzt sein.
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
			Nach diesen Schritten kann der Memberserver wie gewohnt gejoined werden.
  		  </simpara>
  		</listitem>
  	  </itemizedlist>
  	</para>
    </section>
  
    <section id="school:performance:secondarySamba4DC">
  	<title>Installation zusätzlicher Anmeldeserver</title>
  	<para>
  	  In &ucsUAS; Umgebungen in denen Samba 4 Active Directory kompatible Dienste bereitstellt,
      kann zur Skalierung der Anmeldedienste ein zusätzlicher UCS DC Slave an einem Schulstandort
  	  installiert werden. Dieser zusätzliche, sekundäre Domänencontroller wird als standard UCS DC Slave
  	  installiert und muss danach durch Ausführung eines speziellen Skripts an den Schulstandort
	  gejoined werden. Auf diesem sekundären Domänencontroller wird nicht die UCS@school App installiert.
  	</para>
  	<para>
	  Zwischen dem Samba4 Verzeichnisdienst auf dem neuen UCS DC Slave und dem
  	  &ucsUAS; Server wird die DRS Replikation eingesetzt, die Samba 4 auch im standard UCS
  	  verwendet. Die für &ucsUAS; characteristische selektive LDAP-Replikation von Verzeichnisdaten
  	  findet dann wie üblich weiter vom UCS DC Master zu den DC Slave Systemen statt, aber nur
  	  auf dem primären Schulserver findet die Synchronisation mit dem Samba4-Verzeichnisdienst statt.
  	</para>
	<caution>
  	  <para>
  	    Der sekundäre Domänencontroller stellt nur redundante Anmeldedienste zur Verfügung, &ucsUAS; spezifische
  	    Dienste und UMC-Module stellt er nicht bereit.
  	  </para>
  	  <para>
		Damit in diesem Setup der Domänenbeitritt von Windows-Clients problemlos funktioniert, sollten für diese
		immer über die UCS@school spezifischen Import-Werkzeuge Rechnerobjekte in der &ucsUMC; angelegt werden.
		Wenn dies nicht vom dem Domänenbeitritt eines Windows-Clients gemacht wird, kann der Domänenbeitritt
		mit einer Windows-Fehlermeldung abbrechen. Dies ist darauf zurückzuführen, dass zur Konfliktvermeidung
		im Samba Verzeichnisdienst auf dem sekundären Schul-DC per Voreinstellung keine neuen Maschinenkonten
		angelegt werden können.
  	  </para>
    </caution>
  	<para>
  	  Um einen solchen sekundären Domänencontroller an einem Schulstandort zu installieren und zu joinen, müssen
	  auf dem Master folgende vorbereitende Schritte als <emphasis>root</emphasis> durchgeführt werden:
  	  <itemizedlist>
  		<listitem>
  		  <simpara>
  			<programlisting>
/usr/share/ucs-school-import/scripts/create_ou \
	&lt;Schul-OU&gt; &lt;Name des neuen Schul-DCs&gt;
  			</programlisting>
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
  			<programlisting>
/usr/share/ucs-school-import/scripts/move_domaincontroller_to_ou \
	--ou &lt;Schul-OU&gt; --dcname &lt;Name des neuen Schul-DCs&gt;
  			</programlisting>
  		  </simpara>
  		</listitem>
  		<listitem>
  		  <simpara>
  			<programlisting>
cd /usr/share/ucs-school-import/scripts
scp ucs-school-join-secondary-samba4 root@&lt;Name des neuen Schul-DCs&gt;:
  			</programlisting>
  		  </simpara>
  		</listitem>
  	  </itemizedlist>
  	</para>
  	<para>
	  Danach muss auf dem neuen DC Slave folgender Schritt zum Joinen als <emphasis>root</emphasis> ausgeführt werden:
  	  <itemizedlist>
  		<listitem>
  		  <simpara>
  			<programlisting>
/root/ucs-school-join-secondary-samba4 &lt;IP des primären Schul-DCs&gt;
  			</programlisting>
  		  </simpara>
  		</listitem>
  	  </itemizedlist>
  	</para>
    </section>
  </section>
</chapter>
