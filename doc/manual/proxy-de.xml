<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE chapter [
	<!ENTITY % extensions SYSTEM "../stylesheets/macros.ent" >
	<!ENTITY % DocBookDTD PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
	<!ENTITY % entities SYSTEM "../stylesheets/macros-de.ent" >
	%extensions;
	%DocBookDTD;
	%entities;
]>
<chapter id="school:proxy">
  <title>Web-Proxy auf den Schulservern</title>
  <para>
	In der Grundeinstellung läuft auf jedem Schulserver (bzw. im Single-Server-Betrieb auf dem
	&ucsMaster;) ein Proxy-Server auf Basis von Squid im Zusammenspiel mit squidGuard. Der Proxy erlaubt
	Lehrern in Schulstunden den Zugriff auf einzelne Webseiten zu beschränken oder auch generell
	bestimmte Webseiten zu sperren. Dies ist in der &ucsUAS;-Lehrerdokumentation <biblioref
	linkend="ucs-school-teacher"/> beschrieben.
  </para>
  <para>
	Der Proxyserver muss zwingend auf dem jeweiligen Schulserver betrieben werden.
  </para>
  <para>
	Die Proxykonfiguration wird in der Grundeinstellung durch DHCP verteilt, diese Einstellung wird
	jedoch nicht von allen Browsern unterstützt. Die Konfiguration kann alternativ über eine
	Proxy-Autokonfigurationsdatei (PAC-Datei) automatisiert werden. In PAC-Dateien sind die relevanten
	Konfigurationsparameter zusammengestellt. Die PAC-Datei eines Schulservers steht unter der folgenden URL bereit:
  </para>
  <para>
	<uri>http://<replaceable>schulserver.domaene.de</replaceable>/proxy.pac</uri>
  </para>
  <para>
	Im Internet Explorer 8 wird die PAC-Datei beispielsweise unter <guimenu>Internetoptionen
	&ar; Reiter Verbindungen &ar; LAN-Einstellungen &ar; Automatisches
	Konfigurationsskript verwendet</guimenu> zugewiesen.
  </para>
  <para>
	In Firefox 10 kann die PAC-Datei im Menü unter <guimenu>Bearbeiten &ar;
	Einstellungen &ar; Erweitert &ar; Netzwerk &ar; Verbindungen &ar; Einstellungen &ar; Automatische
	Proxy-Konfigurations-URL</guimenu> zugewiesen werden.
  </para>
  <para>
	Bei Einsatz von Samba 4 kann die Proxy-Konfiguration alternativ auch über Gruppenrichtlinien
	zugewiesen werden.
  </para>
  <section id="school:proxy:blacklists">
	<title>Einbindung von externen Blacklisten</title>
	<para>
		Der Proxy von &ucsUAS; unterstützt (ab &ucsUAS; 4.0 R2 und mindestens UCS 4.0 Erratum 163) die Einbindung von externen Blacklisten, welche als Textdateien vorliegen müssen.
	</para>
	<para>
	  Die Textdateien dürfen jeweils nur Domänennamen oder URLs enthalten. Pro Zeile darf nur ein Eintrag (Domänenname/URL) enthalten sein.
	  Die Textdateien müssen unterhalb des Verzeichnisses <filename class="directory">/var/lib/ucs-school-webproxy/</filename> abgelegt werden. Die Verwendung von weiteren Unterverzeichnissen ist möglich.
	</para>
	<para>
	  Eingebunden werden die Blacklisten über das Setzen von zwei UCR-Variablen: <envar>proxy/filter/global/blacklists/domains</envar> und <envar>proxy/filter/global/blacklists/urls</envar>.
	  Diese Variablen enthalten die Dateinamen der Domänen-Blacklisten bzw. URL-Blacklisten. Die Dateinamen sind relativ zum Verzeichnis <filename class="directory">/var/lib/ucs-school-webproxy</filename> anzugeben und müssen durch Leerzeichen voneinander getrennt werden.
	</para>
	<para>
	  Die Einbindung der folgenden, exemplarischen Blacklist-Dateien
	  <programlisting>
/var/lib/ucs-school-webproxy/extblacklist1/domains
/var/lib/ucs-school-webproxy/extblacklist1/urls
/var/lib/ucs-school-webproxy/bl2/list-domains
/var/lib/ucs-school-webproxy/bl2/list-urls
/var/lib/ucs-school-webproxy/bl3-dom
/var/lib/ucs-school-webproxy/bl3-urls
	  </programlisting>
	  kann über die nachfolgenden <command>ucr set</command>-Befehle erreicht werden:
	  <programlisting>
ucr set proxy/filter/global/blacklists/domains=\
     "extblacklist1/domains bl2/list-domains bl3-dom"
ucr set proxy/filter/global/blacklists/urls=\
     "extblacklist1/urls bl2/list-urls bl3-urls"
	  </programlisting>
	</para>
	<para>
		Die Blacklisten werden vom Proxy in der Standardeinstellung mit niedriger Priorität
		ausgewertet, d.h. (temporäre) Whitelisten von Schuladministratoren und Lehrern haben Vorrang.  Um
		die globalen Blacklisten vorrangig auszuwerten, kann die UCR-Variable
		<envar>proxy/filter/global/blacklists/forced</envar> auf den Wert <literal>yes</literal> gesetzt
		werden. Die Blacklisten können anschließend nicht mehr durch Schuladministratoren oder Lehrer in der
		UMC umgangen bzw. zeitweilig deaktiviert werden.
	</para>
	<note>
	  <para>
		Es ist zu beachten, dass bei einer Aktualisierung der Blacklist-Textdateien die internen Filterdatenbanken des Proxys nicht ebenfalls automatisch aktualisiert werden.
		Um dies zu erreichen, müssen die beiden UCR-Variablen erneut gesetzt werden.
	  </para>
	</note>
	<note>
	  <para>
		Abhängig von der Anzahl der Einträge in den eingebundenen Blacklisten, kann die Aktualisierung der internen Filterdatenbanken beim Setzen der UCR-Variablen mehrere Sekunden benötigen.
	  </para>
	</note>
  </section>
</chapter>
