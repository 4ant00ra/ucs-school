%autobuild=true changelog

\input{handbuch_pdf_1}

\newcommand{\ucsManualTitle}{UCS@school 3.1 Release Notes}
\newcommand{\ucsManualSubtitle}{Release Notes für die Inbetriebnahme und
Aktualisierung von \ucsUAS{} 3.1}
\newcommand{\ucsManualVersion}{3.1}
\newcommand{\ucsTechAuthor}{ & Univention GmbH & feedback@univention.de}
\newcommand{\ucsSVNVersion}{16319}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\input{handbuch_pdf_2_school}

\chapter{Release-Highlights}

Mit Univention Corporate Server 3.1 steht das vierte Release für
\ucsUAS{} zur Verfügung. Es umfasst eine Reihe von Detailverbesserungen und Fehlerkorrekturen sowie die
folgenden Neuerungen:
\begin{itemize}
\item Ein Einrichtungsassistent für UCS@school nach der Installation.
\item Mit dem neuen Release steht die Dokumentation neben dem PDF-Format jetzt auch im HTML-Format zur Verfügung.
\end{itemize}


\section{Aktualisierung auf UCS 3.1}
\ucsUAS{} basiert nun auf UCS 3.1 und profitiert dadurch von allen Erweiterungen und Korrekturen, die direkt
in UCS eingeflossen sind.

\section{Bereitstellung über Univention App Center}
Die Installation von \ucsUAS{} wurde mit der Integration in Univention App Center erheblich vereinfacht.
Mit wenigen Klicks kann im Modul \ucsName{App Center} der \ucsUMC{} \ucsUAS{} auf einem UCS"=System
installiert werden. Die manuelle Anpassung von Repositoryeinstellungen entfällt.

Während des Updates auf UCS 3.1 wird automatisch auf die \ucsUAS{}"=Applikation umgestellt, so
dass weitere Updates über das Univention App Center bezogen werden können.

\section{Einrichtungsassistent für \ucsUAS{}}
Nach der Installation von \ucsUAS{} steht jetzt ein Einrichtungsassistent zur Verfügung, der in wenigen
Schritten alle zur Konfiguration von \ucsUAS{} notwendigen Informationen abfragt und anschließend die
Konfiguration selbstständig vornimmt.

\section{Dokumentation in den Formaten HTML und PDF}
Die Dokumentationen für Administratoren und für Lehrkräfte stehen jetzt nicht nur als PDF sondern auch im
HTML"=Format zur Verfügung. Beide Versionen können unter \ucsURL{http://docs.univention.de/} abgerufen werden.

\chapter{Empfohlene Update-Reihenfolge für Umgebungen mit mehr als einem UCS-Server / Update von Systemen mit UCS-Komponenten}

Für das Update von UCS-Umgebungen mit mehr als einem UCS-System wird
die nachfolgende Vorgehensreihenfolge empfohlen und muss beachtet werden:

Auf dem \ucsMaster{} wird die maßgebliche (authoritative) Version des
LDAP-Verzeichnisdienstes vorgehalten, die an alle übrigen LDAP-Server
der UCS-Domäne repliziert wird. Da bei Release-Updates Veränderungen
an den LDAP-Schemata auftreten können (siehe
Kapitel 3.4.1 des Handbuchs \cite{UCS-Handbuch}) muss der \ucsMaster{} bei einem
Release-Update immer als erstes System aktualisiert werden.
Generell ist es empfehlenswert alle UCS-Systeme möglichst in einem
Wartungsfenster zu aktualisieren. 

\section{Hinweise zu Umgebungen mit Dritt-Software}

Bei der Verwendung von 3rd-Party-Software ist generell \emph{vor} dem Update
mit dem Hersteller/Vertriebspartner der Software zu klären, ob
diese mit der neuen Version von Univention Corporate Server weiterhin
uneingeschränkt einsetzbar ist. 

Die Hersteller/Vertriebspartner von auf Univention Corporate Server
basierenden Produkten sorgen eigenständig für die Veröffentlichung. Updates
müssen daher von dort bezogen werden.

Falls Ihnen von Univention angepasste Paketversionen bereitgestellt wurden, so
sollte geprüft werden, ob durch die Aktualisierung angepasste Pakete
überschrieben werden --- vorzugsweise in einer Testumgebung. Sollten Sie hier
Probleme feststellen, so wenden Sie sich bitte an Univention.

\chapter{Vorbereitung des Updates}
Vor einem Update auf UCS 3.1"=0/\ucsUAS{} 3.1 muss auf UCS 3.0-2 aktualisiert werden.

Es sollte geprüft werden, ob ausreichend Festplattenplatz verfügbar ist. Eine
Standard-Installation benötigt mindestens 6 GB Speicherplatz. Das
Update benötigt je nach Umfang der vorhanden Installation mindestens 2 GB
weiteren Speicherplatz zum Herunterladen und Installieren der Pakete.

Für das Update sollte eine Anmeldung auf der Console mit dem
Benutzer \emph{root} durchgeführt und das Update dort gestartet werden.
Alternativ kann das Update über die \ucsUMC{} durchgeführt werden.

Eine Remote-Aktualisierung über SSH wird nicht empfohlen, da dies
beispielsweise bei Unterbrechung der Netzwerkverbindung zum Abbruch des
Update-Vorgangs und zu einer Beeinträchtigung des Systems führen kann. Sollte
dennoch eine Aktualisierung über eine Netzverbindung durchgeführt werden, ist
sicherzustellen, dass das Update bei Unterbrechung der Netzwerkverbindung trotzdem
weiterläuft. Hierfür können beispielsweise die Tools \ucsCommand{screen} oder
\ucsCommand{at} eingesetzt werden, die auf allen Systemrollen installiert sind.


\chapter{Nachbereitung des Updates}

Nach dem Update sollte auf allen Systemen der
Befehl \ucsCommand{univention-run-join-scripts} als
Benutzer \emph{root} aufgerufen werden, um nicht aufgerufene Joinskripte auszuführen, und
das UCS-System anschließend neu gestartet werden. Alternativ kann die Ausführung 
der Joinskripte auch im UMC"=Modul \ucsName{Domänenbeitritt} ausgelöst werden.

\section{Konfiguration von Freigabeservern je Schule}
Seit \ucsUAS{} 3.1 können an OU"=Objekten im LDAP"=Verzeichnis zwei Fileserver definiert werden.
Sie werden von den Importskripten beim Anlegen von neuen Klassenfreigaben und Heimatverzeichnisfreigaben
ausgelesen und entsprechend an den neuen Freigabeobjekten als Fileserver eingetragen.

Während des Update von \ucsUAS{} 3.0 nach 3.1 werden die zuständigen Fileserver automatisch ermittelt und an
den OU"=Objekten nachgetragen. Es sollten daher die automatisch hinterlegten Fileservereinstellungen aller OUs
überprüft werden. Bei mehreren OUs auf einem Schulserver kann es z.B. sein, dass eine automatische Zuordnung
nicht möglich war. 

Um das automatische Update der OU"=Objekte zu verhindern, kann \emph{vor} dem Update die \ucsUCR{"=Variable} 
\ucsUCRVSA{update31/ucsschool/ou\_fileserver/update} auf dem Domänencontroller Master auf den Wert \emph{no}
gesetzt werden. Die Aktualisierung der OU"=Objekte kann dann nachträglich manuell gestartet werden:\\
\begin{ucsConsoleInput}
root@master# cd /usr/share/ucs-school-import/scripts/
root@master# ./ucs-school-update-ou-fileservers --auto-detect
\end{ucsConsoleInput}


\section{Anpassung der Passwort-Richtlinien beim Einsatz von Samba 4}
Ab UCS 3.1 werden die Einstellungen des Samba-Domänenobjekts (zu
finden im Modul \ucsMenuEntry{LDAP-Verzeichnis} der \ucsUMC{} im Container \emph{samba}) mit den
Samba-Passworteinstellungen synchronisiert. Nach dem Update auf UCS
3.1 greifen dann die strengeren Einstellungen aus Samba 4.

Die Einstellungen sollten nach dem Update geprüft und ggf. angepasst
werden. Hinweise zur Konfiguration finden sich im Kapitel 5.3 des UCS
3.1-Handbuchs (Passwort-Einstellungen für Windows-Clients bei
Verwendung von Samba 4).

Insbesondere wenn bisher kein maximales Passwortalter am Samba-Domänenobjekt gesetzt war,
sollte nach dem Update das maximale Passwortalter in Samba 4 durch
Ausführung des folgenden Kommandos ebenfalls auf den speziellen Wert 0
gesetzt werden:
\begin{ucsConsoleInput}
samba-tool domain passwordsettings set --max-pwd-age 0
\end{ucsConsoleInput}


\section{Anpassung der Dateisystem-Zugriffsrechte für Gruppenrichtlinienobjekte in der Sysvol-Freigabe}
Die in UCS 3.1 eingesetzte Version von Samba 4 verwendet ein
überarbeitetes VFS-Modul zur Speicherung von Dateizugriffsrechten
(NTACLs und fACLs). Nach dem Update sollte der folgende Befehl
einmalig auf allen UCS 3.1 Domänencontrollern mit Samba 4 aufgerufen
werden:
\begin{ucsConsoleInput}
samba-tool ntacl sysvolreset
\end{ucsConsoleInput}
Wegen der Sysvol-Replikation sollte das Kommando als erstes auf dem System aufgerufen werden, das den
Univention S4 Connector bereitstellt, d.h. in den meisten Fällen
zuerst auf dem \ucsMaster{}.



\chapter{Hinweise zum Einsatz einzelner Pakete (siehe auch Release Notes für UCS 3.1)}

\section{Empfohlene Browser für den Zugriff auf die Univention Management Console}

\ucsUMC{} verwendet für die Darstellung der Web-Oberfläche zahlreiche
Javascript- und CSS-Funktionen. Cookies müssen im Browser zugelassen
sein. Die folgenden Browser werden empfohlen:

\begin{itemize}
\item Chrome ab Version 14
\item Firefox ab Version 10
\item Internet Explorer ab Version 9
\item Safari (auf dem iPad 2)
\end{itemize}

Auf älteren Browsern können Darstellungs- oder Performanceprobleme
auftreten.

\section{Aktivierung der Passwortrotation für Samba 4-Domänencontroller}

Die Rotation der Passworte von Samba 4 Domänencontrollern wird beim Update wieder aktiviert.
Dies ist wichtig, weil sich die domänenweite Einstellung für das maximale Passwortalter
unter Samba 4 auch auf Domänencontroller bezieht. Falls die Passswortrotation der
Domänencontroller nicht gewünscht ist, kann sie auf jedem Domänencontroller einzeln
durch Setzen der \ucsUCR{}-Variable \ucsUCRVSA{server/password/change} auf \emph{no} deaktivert werden.

\section{Einschränkungen im Samba 4-Betrieb}

Die aktuell vom Samba-Projekt veröffentlichten Versionen von Samba 4
unterliegen in der Weiterentwicklung noch stärkeren Änderungen als Samba
3. Einige Funktionalitäten stehen daher noch nicht vollständig zur Verfügung:

\begin{itemize}
\item Microsoft Windows Domänencontroller dürfen aktuell nicht in eine Samba 4-Domäne
gejoint werden.
\item Eine selektive Replikation ist mit Samba 4 nicht möglich, da diese durch
Active Directory prinzipiell nicht unterstützt wird (in UCS@school
basiert die selektive Replikation auf der Listener/Notifier-Replikation).
\item Samba 4 unterstützt aktuell keine Forest-Domänen. 
\item Samba 4 unterstützt aktuell keine Vertrauensstellungen.
\end{itemize}

Weitere Hinweise finden sich in Kapitel 8 des UCS-Handbuchs \cite{UCS-Handbuch}.

\section{Deaktivierung der Generierung von LM-Hashes}
In Samba 3 wurden die Passwörter von Benutzern im LM-Hashverfahren gespeichert.
In Umgebungen mit UCS 3.x sind diese Hash-Einträge nicht mehr nötig. 

Ab UCS 3.0 werden keine LM-Hashes mehr generiert. Das alte Verhalten kann durch
Setzen der \ucsUCR{}-Variable \ucsUCRVSA{password/samba/lmhash} auf \emph{true} wieder aktiviert 
werden.



\chapter{Changelog}

Die Changelogs mit den detaillierten Änderungsinformationen werden ab UCS 3.0
nur noch in Englisch gepflegt.

\input{changelog-ucsschool-3.1}

\input{bibtex}

\end{document}
