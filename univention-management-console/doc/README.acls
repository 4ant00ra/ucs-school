Dieses Dokument beschreibt die Abbildung der Berechtigungen fÃŒr die neue
Univention Console.


Anforderungen an die Berechtigungen:

 - Die Berechtigungen mÃŒssen bis auf Befehlsebene definiert werden kÃ¶nnen.
 - Berechtigungen an Benutzer und Gruppen als Richtlinie
 - Die Benutzerberechtigung ÃŒberschreibt die Gruppenberechtigung
 - additive Vererbung
 - Wir mÃŒssen in der Richtlinie aber auch direkt einen Befehl bzw. eine
   Befehlsgruppe deaktivieren kÃ¶nnen.
 - Die Berechtigungen mÃŒssen auch funktionieren, wenn keine LDAP Verbindung
   besteht.
 - Gruppen in Gruppen sollen unterstÃŒtzt werden.
 - Alle nicht angegebenen Sachen werden nicht erlaubt.
 - Befehlsdefinition fÃŒr Rechner bzw. Rechnergruppen


Die Richtlinie beinhaltet primÃ€r eine Liste von "allow" und "disallow" DNs,
univentionConsoleAllow und univentionConsoleDisallow. die beiden Werte sind 
Multivalue Variablen. Die Richtlinie kann sowohl an Gruppen, als auch an
Benutzern gehÃ€ngt werden.
Gruppenrichtlinie.

objectClass: univentionPolicyConsoleAccess
attribute: univentionConsoleAllow			[multivalue]
attribute: univentionConsoleDisallow		[multivalue]

In den Attributen univentionConsoleAllow und univentionConsoleDisallow sind
die DNs der ACL Objekte gespeichert. Die ACL Objekte sind wie folgt aufgebaut:

objectClass: univentionConsoleACL
attribute: cn
attribute: description
attribute: category
attribute: host				[multivalue]
attribute: ldap_base
attribute: command			[multivalue]
attribute: data

Immer wenn ein Wert nicht angegeben ist, dann wird dieser als .* (regulÃ€rer
Ausdruck in Python) bzw. bei der LDAP Basis mit ldap/base ersetzt.

Die Attribute enthalten die folgenden Informationen:
 - cn: Gibt den Namen des ACLs Objektes an.
 - description: Beschreibt das ACL Objekt, dieser Wert kann direkt in der
   Richtlinie angezeigt werden.
 - category: Definiert eine Kategorie, ÃŒber die die Drop-Downs in der
   Richtlinie aufgeteilt werden. Da wir in grossen Umgebungen wahrscheinlich
   schnell 500 ACL Objekte haben.
 - host: Definiert eine Liste von Rechnern bzw. von Rechnergruppen.
 - ldap_base: DarÃŒber kann die Suche nach den Rechnern bzw. der Rechnergruppe
   eingeschrÃ€nkt werden.
 - command: Gibt eine Liste von Kommandos an
 - data: Definiert die Daten, die verÃ€ndert werden dÃŒrfen, das ist besonders
   fÃŒr Univention Baseconfig hilfreich.

Beispiele:

****************************************************************************
objectClass: univentionConsoleACL
cn: cups1
description: cups on DC Master
category: cups
host: [domaincontroller_master]
ldap_base:
command: cups/.*
data:
****************************************************************************
objectClass: univentionConsoleACL
cn: base_get_mail
description: read baseconfig on all ugs server
caetgory: mail
host: {kolab2}
ldap_base: cn=dc,cn=computers,dc=foo,dc=org
command: baseconfig/get
data: mail/.*
****************************************************************************
objectClass: univentionConsoleACL
cn: base_get_all
description: read all baseconfig variable
caetgory: read
host:
ldap_base:
command: baseconfig/get
data:
****************************************************************************
objectClass: univentionConsoleACL
cn: ldap-cups
description: baseconfig ldap and cups
caetgory: baseconfig
host: [DC Master]
host: {kolab2}
host: rechner.*
host: foo1
ldap_base: cn=dc,cn=computers,dc=foo,org
command: baseconfig/set
data: ldap/*
data: cups/*
****************************************************************************

Beschreibung:
Die Beschreibung wird spÃ€ter in Univention Admin angezeigt. Problematisch ist
hier noch die deutsche Ãbersetzung.

Kategory:
Durch die Kategorie werden die Objekte gruppiert. Die Kategorieren werden
wieder in einem LDAP Objekt registriert.

cn=baseconfig,cn=categories,cn=console,cn=univention,$ldap_base
objectClass: univentionConsoleCategory
cn: baseconfig
description: Univention Baseconfig

cn=mailserver,cn=categories,cn=console,cn=univention,$ldap_base
objectClass: univentionConsoleCategory
cn: baseconfig
description: Mailserver

Rechner/Rechnergruppe:
Hier sollten wir neben den eigentlichen Rechnernamen auch die Systemrollen
verwenden kÃ¶nnen. Die Systemrollen werden in [] angegeben. Dazu kÃ¶nnen wir
auch noch die Systemaufgaben, die wir im Moment nur fÃŒr Kolab2 verwenden, 
angeben. Diese werden in {} angegeben. NatÃŒrlich kÃ¶nnen die unterschiedlichen
Dinge auch gemischt werden, die Angaben werden dabei additive interpretiert.

Befehle bzw. Befehlsgruppen:
Die Befehle bzw. Befehlsgruppen kÃ¶nnen NICHT als Komma Liste angegeben werden.
Es wird immer nur ein Befehl oder eine Befehlsgruppe angegeben. Dabei wird .*
als Wildcard ausgewertet.

Daten:
Das kÃ¶nnen unterschiedliche Werte sein, bei Univention Baseconfig Befehlen sind
das die Variablen, die gesetzt werden kÃ¶nnen, wobei dort aber nur die Variablen,
nicht die mÃ¶glichen Werte definiert werden. Diese Liste ist ebenfalls Komma
getrennt und interpretiert .* als Wildcard.



Vererbung
Die Benutzerrichtlinie ÃŒberschreibt immer die Gruppenrichtlinie. Ansonsten
werden alle Berechtigungen additiv vererbt. Wenn in der Gruppenrichtlinie fÃŒr
die Gruppe A ein Befehl X verboten wird, in der Gruppenrichtlinie fÃŒr Gruppe B
der Befehl X wieder erlaubt und der Benutzer in beiden Gruppen ist, dann ist
fÃŒr ihn der Befehl X erlaubt.


Damit die Befehle in Univention Admin per Drop-Down ausgewÃ€hlt werden kÃ¶nnen,
sollten die Befehle registriert werden. Dabei werden unterhalb von cn=univention
die Befehle definiert, z.B.:

objectClass: univentionConsoleOperations
description: printer administration
univentionConsoleOperation: cups/add
univentionConsoleOperation: cups/modify/start
univentionConsoleOperation: cups/modify/stop
univentionConsoleOperation: cups/remove

Wahrscheinlich werden die Console Operationen hÃ€ufig von DC Slaves oder Clients
mitgebracht, von daher benÃ¶tigen die Rechneraccounts Schreibzugriff auf den
Bereich im LDAP.


Berechtigung wenn OpenLDAP nicht erreichbar ist
Beim Auslesen der Berechtigungen aus dem Verzeichnisdienst werden die ACLs im
Dateisystem zwischengespeichert. 
/var/cache/univention-console/acls/Administrator
/var/cache/univention-console/acls/user2
Meldet sich der Benutzer zum ersten Mal an und es gibt keine ACL Datei fÃŒr
den Benutzer, dann wird der Zugriff verweigert.
