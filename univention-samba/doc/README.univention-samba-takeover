univention-samba-takeover is a script to import the user information of a previously
existing Samba host into an UCS system.

User information is read from a pdbdump, which can be extracted with
# pdbedit -L -v > pdbdump
Password information is read from the password hash file, which is typically found
in /etc/samba/smbpasswd
Information about POSIX groups and primary groups is read from /etc/passwd and /etc/group.

Samba group mapping information is read from a dump, which can be generated with
# net groupmap list > file

Users are created on the UCS system and their Samba and LAN Man passwords are reinstated from the
extracted password hashes. The password for the POSIX account refers to the LM hash stored in LDAP.
Also, Kerberos keys are created.
Groups are recreated along with the original RIDs.

The password history isn't fully preserved due to the creation of the new accounts.

The following information is transformed:
- Samba user accounts
- Samba machine accounts
- Samba passwords
- LAN Manager passwords
- Account flags

The following options are accepted

        --sid <new SID>
        --smbpasswdfile <file>
        --pdbdump <file>
        --serverDN <LDAP server base dn>
        --userbase <LDAP user container dn>
        --computerbase <LDAP computer container dn>
	--groupbase <LDAP groups container dn>
        --passwdfile <file>
        --groupfile <file>
	--groupmapfile <file>

Mandatory parameters:
--sid           The Samba ID of the system you are about to import user data from.
--smdpasswdfile The filename of the smbpasswd file
--pdbdump       The filename of the user data dump
--passwdfile    The filename for a copy of /etc/passwd or the file itself
--groupfile     The filename for a copy of /etc/group or the file itself
--groupmapfile  A file containing the output of "net groupmap list"

Optional parameters: (UCS default values are used, they're only necessary in non-standard
                      configurations)
--serverDN      The base DN of the LDAP server
--userbase      The default LDAP container for users
--computerbase  The default LDAP container for users
--groupbase     The default LDAP container for users

The script runs considerably faster if you stop the LDAP notifier for the conversion:
# /etc/init.d/univention-directory-notifier stop



